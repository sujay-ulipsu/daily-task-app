<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daily Task Update - SUJJAAAY</title>

  <!-- PWA meta -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#10b981">

  <!-- Inline simple SVG favicon (Sujjay text) -->
  <link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="192" height="192"><rect rx="28" ry="28" width="100%" height="100%" fill="%2310b981"/><text x="50%" y="55%" font-size="48" text-anchor="middle" font-family="Arial, Helvetica, sans-serif" fill="white">SUJJAAAY</text></svg>'>

  <style>
    :root{
      --bg:#f3f4f6; --card:#ffffff; --text:#111827; --muted:#6b7280; --accent:#10b981;
    }
    [data-theme="dark"]{
      --bg:#0b1220; --card:#071018; --text:#dbeafe; --muted:#94a3b8; --accent:#10b981;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    .app{max-width:820px;margin:0 auto;padding:18px;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    input,textarea,select{width:100%;padding:12px;border-radius:10px;border:1px solid #e5e7eb;background:var(--card);color:var(--text);box-sizing:border-box}
    textarea{min-height:64px;resize:vertical}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 1px 0 rgba(0,0,0,0.02);margin-top:12px}
    .row{display:flex;gap:12px}
    .col{flex:1}
    button{background:var(--accent);color:white;border:none;padding:12px;border-radius:12px;font-weight:600}
    .muted{color:var(--muted);font-size:13px;margin-bottom:8px}
    .small-btn{background:transparent;border:1px solid rgba(0,0,0,0.08);padding:8px;border-radius:10px}
    .history-list{max-height:260px;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
    .history-item{padding:10px;border-radius:10px;background:rgba(0,0,0,0.02);font-size:13px}
    .footer{margin-top:14px;display:flex;gap:8px;align-items:center;justify-content:space-between}
    .signature{font-size:13px;color:var(--muted);white-space:pre-line}
    .top-row{display:flex;gap:8px;align-items:center}
    .theme-toggle{padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:var(--card)}
    @media (max-width:520px){ .row{flex-direction:column} }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div>
        <h1>Daily Task Update</h1>
        <div class="muted">Auto report â†’ <strong>Dear Kiran,</strong></div>
      </div>
      <div class="controls">
        <div class="top-row">
          <select id="preset" class="small-btn" title="Quick preset">
            <option value="">Quick actions</option>
            <option value="today">Fill today's date/time</option>
            <option value="clear">Clear form</option>
          </select>
          <button id="viewHistory" class="small-btn">View History</button>
          <button id="themeToggle" class="theme-toggle">Dark</button>
        </div>
      </div>
    </header>

    <div class="card" style="margin-top:10px">
      <div class="muted">Date & Time (auto)</div>
      <div class="row" style="margin-bottom:8px">
        <input id="date" type="date" />
        <input id="time" type="time" />
      </div>

      <div class="muted">1. Tender Master Sheet â€“ Daily Update</div>
      <textarea id="tender" placeholder="Tender Master Sheet â€“ Daily Update"></textarea>

      <div class="muted">2. Logistics â€“ Follow-ups</div>
      <textarea id="logistics" placeholder="Logistics â€“ Follow-ups"></textarea>

      <div class="muted">3. DDPI â€“ Follow-ups</div>
      <textarea id="ddpi" placeholder="DDPI â€“ Follow-ups"></textarea>

      <div class="muted">Other Tasks Completed</div>
      <textarea id="tasks" placeholder="Other Tasks Completed"></textarea>

      <div class="muted">Pending for Tomorrow</div>
      <textarea id="pending" placeholder="Pending for Tomorrow"></textarea>

      <div class="muted">Support Required</div>
      <textarea id="support" placeholder="Support Required"></textarea>

      <div class="footer">
        <div style="display:flex;gap:8px">
          <button id="copyBtn">Copy Report for WhatsApp</button>
          <button id="saveBtn" class="small-btn">Save to History</button>
        </div>
        <div class="signature">
          Regards,
          <br>Su jay B V
          <br>Manager â€“ Educational Institutions & Ops
        </div>
      </div>
      <p id="msg" class="muted" style="margin-top:10px"></p>
    </div>
  </div>

  <!-- History modal (simple) -->
  <div id="historyModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);padding:20px;">
    <div style="max-width:820px;margin:40px auto;background:var(--card);border-radius:12px;padding:14px;">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">History</h3>
        <div style="display:flex;gap:8px">
          <button id="clearHistory" class="small-btn">Clear</button>
          <button id="closeHistory" class="small-btn">Close</button>
        </div>
      </div>
      <div class="history-list" id="historyList" style="margin-top:12px"></div>
    </div>
  </div>

  <script>
    // Utilities
    const el = id => document.getElementById(id);
    const now = new Date();
    const pad = n => n.toString().padStart(2,'0');

    // Fill date/time defaults
    const setAutoDateTime = () => {
      const d = new Date();
      el('date').value = d.toISOString().slice(0,10);
      el('time').value = pad(d.getHours()) + ':' + pad(d.getMinutes());
    };
    setAutoDateTime();

    // load theme
    const applyTheme = (t) => {
      if(t === 'dark'){ document.documentElement.setAttribute('data-theme','dark'); el('themeToggle').innerText='Light'; localStorage.setItem('dt_theme','dark'); }
      else { document.documentElement.removeAttribute('data-theme'); el('themeToggle').innerText='Dark'; localStorage.setItem('dt_theme','light'); }
    };
    const savedTheme = localStorage.getItem('dt_theme') || 'light';
    applyTheme(savedTheme === 'dark' ? 'dark' : 'light');

    el('themeToggle').addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
      applyTheme(current === 'dark' ? 'light' : 'dark');
    });

    // preset actions
    el('preset').addEventListener('change', (e) => {
      if(e.target.value === 'today'){ setAutoDateTime(); el('msg').innerText='Date/time filled.'; }
      if(e.target.value === 'clear'){ ['tender','logistics','ddpi','tasks','pending','support'].forEach(id=>el(id).value=''); el('msg').innerText='Form cleared.'; }
      e.target.value='';
      setTimeout(()=>el('msg').innerText='',1500);
    });

    // Build formatted WhatsApp report
    function buildReport(){
      const date = el('date').value || '';
      const time = el('time').value || '';
      const tender = el('tender').value.trim() || 'â€¢';
      const logistics = el('logistics').value.trim() || 'â€¢';
      const ddpi = el('ddpi').value.trim() || 'â€¢';
      const tasks = el('tasks').value.trim() || 'â€¢';
      const pending = el('pending').value.trim() || 'â€¢';
      const support = el('support').value.trim() || 'â€¢';
      const dt = date ? date : new Date().toISOString().slice(0,10);
      const timeDisplay = time ? time : (new Date()).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

      return [
        `Dear Kiran,`,
        ``,
        `ðŸ“… Date: ${dt}    â° Time: ${timeDisplay}`,
        `ðŸ‘¤ Name: Sujay â€” Manager, EI & Ops`,
        ``,
        `1ï¸âƒ£ Tender Master Sheet â€“ Daily Update`,
        tender,
        ``,
        `2ï¸âƒ£ Logistics â€“ Follow-ups`,
        logistics,
        ``,
        `3ï¸âƒ£ DDPI â€“ Follow-ups`,
        ddpi,
        ``,
        `ðŸ“š Other Tasks Completed Today:`,
        tasks,
        ``,
        `â³ Pending for Tomorrow:`,
        pending,
        ``,
        `ðŸ¤ Support Required:`,
        support,
        ``,
        `Regards,`,
        `Sujay B V`,
        `Manager â€“ Educational Institutions & Ops`
      ].join('\\n');
    }

    // Copy to clipboard
    async function copyReport(){
      const report = buildReport();
      try{
        await navigator.clipboard.writeText(report);
        el('msg').innerText = 'Report copied to clipboard. Paste in WhatsApp.';
      }catch(e){
        // fallback
        const ta = document.createElement('textarea');
        ta.value = report;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        el('msg').innerText = 'Copied (fallback).';
      }
      setTimeout(()=>el('msg').innerText='',2200);
    }

    // Local Storage history
    const HISTORY_KEY = 'dt_history_v1';

    function loadHistory(){
      try{
        const raw = localStorage.getItem(HISTORY_KEY);
        return raw ? JSON.parse(raw) : [];
      }catch(e){ return []; }
    }
    function saveHistoryEntry(obj){
      const arr = loadHistory();
      arr.unshift(obj); // latest first
      // keep 40 entries max
      if(arr.length>40) arr.splice(40);
      localStorage.setItem(HISTORY_KEY, JSON.stringify(arr));
    }

    function renderHistory(){
      const list = el('historyList');
      list.innerHTML = '';
      const arr = loadHistory();
      if(arr.length===0){ list.innerHTML = '<div class="muted">No saved reports yet.</div>'; return; }
      arr.forEach((it, idx) => {
        const d = document.createElement('div');
        d.className = 'history-item';
        d.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
                         <div style="font-weight:600">${it.date} ${it.time}</div>
                         <div style="display:flex;gap:6px">
                           <button data-idx="${idx}" class="small-btn copyHist">Copy</button>
                           <button data-idx="${idx}" class="small-btn delHist">Delete</button>
                         </div>
                       </div>
                       <div style="margin-top:6px;white-space:pre-line;font-size:13px">${it.summary}</div>`;
        list.appendChild(d);
      });
      // attach listeners
      document.querySelectorAll('.copyHist').forEach(btn=>{
        btn.addEventListener('click', async (e)=>{
          const idx = e.target.dataset.idx;
          const arr = loadHistory();
          await navigator.clipboard.writeText(arr[idx].full);
          el('msg').innerText = 'History item copied to clipboard.';
          setTimeout(()=>el('msg').innerText='',2000);
        });
      });
      document.querySelectorAll('.delHist').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const idx = e.target.dataset.idx;
          const arr = loadHistory();
          arr.splice(idx,1);
          localStorage.setItem(HISTORY_KEY, JSON.stringify(arr));
          renderHistory();
        });
      });
    }

    // Save button
    el('saveBtn').addEventListener('click', ()=>{
      const date = el('date').value || (new Date()).toISOString().slice(0,10);
      const time = el('time').value || (new Date()).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
      const full = buildReport();
      const summary = [
        el('tender').value.slice(0,120),
        el('logistics').value.slice(0,120),
        el('ddpi').value.slice(0,120)
      ].filter(Boolean).join(' | ');
      saveHistoryEntry({ date, time, summary, full });
      el('msg').innerText = 'Saved to history.';
      setTimeout(()=>el('msg').innerText='',1500);
    });

    // Copy button
    el('copyBtn').addEventListener('click', async ()=>{
      await copyReport();
    });

    // View history modal
    el('viewHistory').addEventListener('click', ()=>{
      renderHistory();
      el('historyModal').style.display='block';
    });
    el('closeHistory').addEventListener('click', ()=> el('historyModal').style.display='none');
    el('clearHistory').addEventListener('click', ()=>{
      if(confirm('Clear all saved reports?')){ localStorage.removeItem(HISTORY_KEY); renderHistory(); }
    });

    // quick save on unload (optional)
    window.addEventListener('beforeunload', ()=>{ /* nothing */ });

    // service worker registration for offline / PWA
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js').then(()=> {
        // registered
      }).catch(()=>{ /* ignore */ });
    }

    // convenience: fill date/time when user taps header
    document.querySelector('header').addEventListener('dblclick', setAutoDateTime);

  </script>
</body>
</html>